# Core OAuth Module Manifest
# OAuth 2.0 authentication and authorization flows

name: oauth
version: "0.2.0"
display_name: "OAuth Authentication"
description: "OAuth 2.0 authentication, authorization flows, and token management"
authors: ["systemprompt-os"]
license: "Apache-2.0"
weight: -50
category: core
dependencies:
  - users
schemas:
  - file: "schema/oauth_clients.sql"
    table: "oauth_clients"
    required_columns:
      - "client_id"
      - "client_secret_hash"
      - "client_name"
      - "redirect_uris"
      - "created_at"
      - "updated_at"
  - file: "schema/oauth_client_redirect_uris.sql"
    table: "oauth_client_redirect_uris"
    required_columns:
      - "client_id"
      - "redirect_uri"
  - file: "schema/oauth_client_grant_types.sql"
    table: "oauth_client_grant_types"
    required_columns:
      - "client_id"
      - "grant_type"
  - file: "schema/oauth_client_response_types.sql"
    table: "oauth_client_response_types"
    required_columns:
      - "client_id"
      - "response_type"
  - file: "schema/oauth_client_scopes.sql"
    table: "oauth_client_scopes"
    required_columns:
      - "client_id"
      - "scope"
  - file: "schema/oauth_client_contacts.sql"
    table: "oauth_client_contacts"
    required_columns:
      - "client_id"
      - "contact_email"
  - file: "schema/oauth_auth_codes.sql"
    table: "oauth_auth_codes"
    required_columns:
      - "code"
      - "client_id"
      - "user_id"
      - "redirect_uri"
      - "scope"
      - "created_at"
      - "expires_at"
  - file: "schema/oauth_refresh_tokens.sql"
    table: "oauth_refresh_tokens"
    required_columns:
      - "token"
      - "client_id"
      - "user_name"
      - "scope"
      - "expires_at"
      - "created_at"
  - file: "schema/webauthn_credentials.sql"
    table: "webauthn_credentials"
    required_columns:
      - "id"
      - "user_id"
      - "credential_id"
      - "public_key"
      - "counter"
      - "display_name"
      - "device_type"
      - "created_at"
  - file: "schema/webauthn_challenges.sql"
    table: "webauthn_challenges"
    required_columns:
      - "challenge"
      - "user_id"
      - "challenge_type"
      - "session_state"
      - "expires_at"
      - "created_at"

tables_created:
  - "oauth_clients"
  - "oauth_client_redirect_uris"
  - "oauth_client_grant_types"
  - "oauth_client_response_types"
  - "oauth_client_scopes"
  - "oauth_client_contacts"
  - "oauth_auth_codes"
  - "oauth_refresh_tokens"
  - "webauthn_credentials"
  - "webauthn_challenges"
seeds:
  - file: "src/queries/seed/test_client.sql"
    table: "oauth_clients"
    check_column: "client_id"
    check_value: "test-debug-client"
  - file: "src/queries/seed/webauthn_client.sql"
    table: "oauth_clients"
    check_column: "client_id"
    check_value: "sp_web"
  - file: "src/queries/seed/webauthn_client_scopes.sql"
    table: "oauth_client_scopes"
    check_column: "client_id"
    check_value: "sp_web"
api:
  enabled: true
  path_prefix: "/api/v1/oauth"
  openapi_path: "/api/v1/oauth/docs"

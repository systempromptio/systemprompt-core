# Core Agent Module Manifest
# Agent protocol implementation and management

name: agent
version: "0.1.0"
display_name: "Core Agent Protocol"
description: "Agent protocol implementation for orchestrating and managing AI agents"
authors: ["systemprompt-os"]
license: "Apache-2.0"

# Installation weight (core modules: 1-10, foundation: 11-20, business logic: 21-30)
weight: 25
category: core

# Dependencies - requires core auth and user management
dependencies:
  - users
  - oauth
  - mcp

# Schema files with validation metadata
# NOTE: Agent cards are config-driven (infrastructure/configs/agents.yaml)
# Task/message/artifact tables are still used for A2A protocol communication
schemas:
  # A2A Protocol - Task Management (ACTIVE - DO NOT REMOVE)
  # NOTE: user_contexts must come first - agent_tasks has FK to user_contexts
  - file: "schema/user_contexts.sql"
    table: "user_contexts"
    required_columns: ["id", "user_id"]

  - file: "schema/agent_tasks.sql"
    table: "agent_tasks"
    required_columns: ["id", "uuid"]

  - file: "schema/task_messages.sql"
    table: "task_messages"
    required_columns: ["id", "task_id"]

  - file: "schema/message_parts.sql"
    table: "message_parts"
    required_columns: ["id", "message_id"]

  - file: "schema/task_artifacts.sql"
    table: "task_artifacts"
    required_columns: ["id", "task_id"]

  - file: "schema/artifact_parts.sql"
    table: "artifact_parts"
    required_columns: ["id", "artifact_id"]

  - file: "schema/context_agents.sql"
    table: "context_agents"
    required_columns: ["id", "context_id", "agent_id"]

  - file: "schema/context_notifications.sql"
    table: "context_notifications"
    required_columns: ["id", "context_id", "agent_id"]

  - file: "schema/task_push_notification_configs.sql"
    table: "task_push_notification_configs"
    required_columns: ["id", "task_id", "url", "endpoint"]

  # Skills Management (database-driven skill ingestion)
  - file: "schema/agent_skills.sql"
    table: "agent_skills"
    required_columns: ["skill_id", "file_path", "name", "instructions"]

  # Task Execution Steps (AG-UI protocol - execution timeline tracking)
  - file: "schema/task_execution_steps.sql"
    table: "task_execution_steps"
    required_columns: ["id", "step_id", "task_id", "step_type", "status"]

  # Cross-module analytics views (references user_sessions, user_contexts, task_messages)
  - file: "schema/user_session_analytics.sql"
    table: ""
    required_columns: []

# Tables this module creates (for validation)
# NOTE: Agent cards are config-driven (no agent_cards/agent_metadata tables)
# Task/message/artifact tables used for A2A protocol communication
tables_created:
  # A2A Protocol - Task Management
  - "agent_tasks"
  - "task_messages"
  - "message_parts"
  - "task_artifacts"
  - "artifact_parts"
  - "user_contexts"
  # Multi-Agent Context Tracking
  - "context_agents"
  # Notification Callback Tracking
  - "context_notifications"
  # A2A Push Notification Config Management
  - "task_push_notification_configs"
  # Skills Management
  - "agent_skills"
  # AG-UI Protocol - Execution Timeline
  - "task_execution_steps"

# Seed files with validation metadata
seeds: []

# Module configuration
config:
  required: false

# API configuration
api:
  enabled: true
  path_prefix: "/api/v1/agents"
  openapi_path: "/api/v1/agents/docs"
audience: []